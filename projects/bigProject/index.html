<!DOCTYPE html>
<html>
<head>
	<title>MyTransitApp</title>

	<!-- the MCW stylesheet-->
  	<link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">

	<!-- the material icon font-->
  	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

	<!-- Personal CSS -->
	<style type="text/css">

	  	.hide {
	  		display: none;
	  	}

	  	#busTrainTabBar {
			padding-top: 30px;
			padding-bottom: 40px;
		}

		#logoImg {
			width: 100%;
		}

  		#shrine-header {
  			background-color: #E2E2E2;
  		}

  		.submitBtn {
			font-size: 30px;
		}

		#map
	   	{
	   		margin: 20px;
	   		padding: 20px;
        	height: 600px;
        }

  		.container {
			text-align: center;
			margin: auto;
			width: 66.6%;
			height: 66.6%;
		}

		#shrine-header .mdc-toolbar__section {
			overflow: visible;
		}

		.mdc-tab {
			font-size: 25px;
			padding: 15px 50px;
		}

		.mdc-select {
			margin: 30px;
			width: 30%;
		}

		.mdc-button {
			margin: 20px;
		}

		.mdc-radio {
			padding: 30px;
		}


	</style>

</head>

<body class="mdc-typography">

	<!-- tool bar -->
	<header id="shrine-header" class="mdc-toolbar mdc-toolbar--fixed mdc-theme--text-primary-on-background">
		<div class="mdc-toolbar__row">
	    	<section class="mdc-toolbar__section mdc-toolbar__section--align-start">
				<a id="shrine-nav-icon" class="material-icons mdc-ripple-surface"
				   href="#"
				   aria-label="Click to show the navigation menu"
				   aria-controls="shrine-nav-menu"
				   data-mdc-auto-init="MDCRipple"
				   data-mdc-ripple-is-unbounded>menu
				</a>
		    </section>
	  	</div>
	</header>

	<!-- temporary drawer of the tool bar -->
	<aside class="mdc-drawer mdc-drawer--temporary mdc-typography">
		<nav class="mdc-drawer__drawer">
	    	<header class="mdc-drawer__header">
	      		<div class="mdc-drawer__header-content">
	      			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">directions_bus</i>
	      			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">train</i>
	      			<strong>UIC East Campus -- MyTransitApp ------- CTA Version ---------</strong>
	      		</div>	
	    	</header>
	    	<nav id="icon-with-text-demo" class="mdc-drawer__content mdc-list">
	      		<a id="arrivalsNav" class="mdc-list-item mdc-list-item--activated" href="#">
	       			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">alarm</i>Estimated Arrivals
	      		</a>
	      		<a id="nearMeNav" class="mdc-list-item" href="#">
	       			<i class="material-icons mdc-list-item__graphic" aria-hidden="true">person_pin_circle</i>Near Me
	      		</a>
	      		<a id="settingsNav" class="mdc-list-item" href="#">
	        		<i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>Settings
	      		</a>
	    	</nav>
	  	</nav>
	</aside>

	<!-- screen 1 -->
	<div id="arrivalsScreen">
		<br><br><br>
		<!-- UIC Halsted image -->
		<img id="logoImg" src="imgs/halsted.jpg">
		<div class="container">
			<!-- bus/train tab bar  -->
			<div id="busTrainTabBar">
				<nav id="basic-tab-bar" class="mdc-tab-bar">
					<a id="busNav" class="mdc-tab mdc-tab--active" href="#">Bus</a>
					<a id="trainNav" class="mdc-tab" href="#">Train</a>
					<span class="mdc-tab-bar__indicator"></span>
				</nav>
			</div>
			<div id="busTab">
				<!-- bus route drop down select menu -->
				<div id="busRoute" class="mdc-select">
					<select id="busRouteSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option value="seven">7 - Harrison</option>
						<option value="eight">8 - Halsted</option>
						<option value="twelve">12 - Roosevelt</option>
						<option value="sixty">60 - Blue Island/26th</option>
						<option value="one-fifty-seven">157 - Streeterville/Taylor</option>
					</select>
					<div class="mdc-select__label">Select Route</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- bus direction drop down select menu -->
				<div id="busDirection" class="mdc-select">
					<select id="busDirectionSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option id="north" class="hide" value="Northbound">Northbound</option>
						<option id="south" class="hide" value="Southbound">Southbound</option>
						<option id="east" class="hide" value="Eastbound">Eastbound</option>
						<option id="west" class="hide" value="Westbound">Westbound</option>
					</select>
					<div class="mdc-select__label">Select Direction</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- bus stop drop down select menu -->
				<div id="busStop" class="mdc-select">
					<select id="busStopSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option  id="none" value="none">Placeholder</option>
					</select>
					<div class="mdc-select__label">Select Stop</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br><br>
				<button id="busSubmitBtn" class="mdc-button submitBtn"><strong>TRACK</strong></button>
			</div>
			<div id="trainTab" class="hide">
				<!-- train route drop down select menu -->
				<div id="trainStop" class="mdc-select">
					<select id="trainStopSelect" class="mdc-select__native-control">
						<option value="" disabled selected></option>
						<option value="Clarke/Lake">Clarke/Lake</option>
						<option value="Washington">Washington</option>
						<option value="Monroe">Monroe</option>
						<option value="Jackson">Jackson</option>
						<option value="LaSalle">LaSalle</option>
						<option value="Clinton">Clinton</option>
						<option value="UIC-Halsted">UIC-Halsted</option>
						<option value="Racine">Racine</option>
						<option value="Illinois Medical District">Illinois Medical District</option>
					</select>
					<div class="mdc-select__label">Select Stop</div>
					<div class="mdc-select__bottom-line"></div>
				</div>
				<br>
				<!-- radio button for Forest Park -->
				<div class="mdc-radio">
					<input class="mdc-radio__native-control" type="radio" id="radio-1" name="radios" checked>
					<div class="mdc-radio__background">
						<div class="mdc-radio__outer-circle"></div>
						<div class="mdc-radio__inner-circle"></div>
					</div>
				</div>
				<label id="radio-1-label" class="bound" for="radio-1">To Forest Park</label>
				<!-- radio button for O'Hare -->
				<div class="mdc-radio">
					<input class="mdc-radio__native-control" type="radio" id="radio-2" name="radios">
					<div class="mdc-radio__background">
						<div class="mdc-radio__outer-circle"></div>
						<div class="mdc-radio__inner-circle"></div>
					</div>
				</div>
				<label id="radio-2-label" class="bound" for="radio-2">To O'Hare</label>
				<br><br><br>
				<button id="trainSubmitBtn" class="mdc-button submitBtn"><strong>TRACK</strong></button>
			</div>
		</div>â€‹
	</div>

	<!-- screen 2 -->
	<div id="nearMeScreen" class="hide">
		<br><br>

		<div class="container">
			<h1>Near Me Screen</h1>
		</div>

		<div id="map"></div>
	</div>


	<!-- screen 3 -->
	<div id="settingsScreen" class="hide">
		<br><br>

		<div class="container">
			<h1>Settings Screen</h1>
		</div>
		
	</div>






	<!-- MCW Script -->
	<script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.js"></script>

	<!-- JQuery CDN -->
	<script
		src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
		crossorigin="anonymous">	
	</script>

    <!-- Personal JavaScript -->
    <script type="text/javascript">

	   	$(document).ready(function(){
	   		console.log("Document Ready");
	   	});

	   	// Script for temporary drawer for the tool bar
	   	let drawer = new mdc.drawer.MDCTemporaryDrawer(document.querySelector('.mdc-drawer--temporary'));
		document.querySelector('#shrine-nav-icon').addEventListener('click', () => drawer.open = true);

	   	/**********************************************************************************************
		*
		* adding action listeners to the tool bar items and the arrival screen's tab bar items
		* 
	   	**********************************************************************************************/

	   	// add action listeners to the 'arrivals', 'near me', and 'settings' navigation items in the nav bar
		navListener("#arrivalsNav", "#arrivalsScreen", "#nearMeNav", "#nearMeScreen", "#settingsNav", "#settingsScreen");
		navListener("#nearMeNav", "#nearMeScreen", "#arrivalsNav", "#arrivalsScreen", "#settingsNav", "#settingsScreen");
		navListener("#settingsNav", "#settingsScreen", "#arrivalsNav", "#arrivalsScreen", "#nearMeNav", "#nearMeScreen");

		function navListener(mainNav, mainScreen, nav2, screen2, nav3, screen3)
		{
			$(mainNav).click(function(){
				$(mainNav).addClass("mdc-list-item--activated");
				$(nav2).removeClass("mdc-list-item--activated");
				$(nav3).removeClass("mdc-list-item--activated");

				$(mainScreen).removeClass("hide");
				$(screen2).addClass("hide");
				$(screen3).addClass("hide");

				drawer.open = false;
			});
		}

	   	// add action listeners to the 'home' and 'train' tab in the 'arrivals' screen
	   	tabListener("#busNav", "#busTab", "#trainNav", "#trainTab");
	   	tabListener("#trainNav", "#trainTab", "#busNav", "#busTab");

	   	function tabListener(mainNav, mainTab, otherNav, otherTab)
		{
			$(mainNav).click(function(){
		   		$(mainNav).addClass("mdc-tab--active");
		   		$(otherNav).removeClass("mdc-tab--active");

		   		$(mainTab).removeClass("hide");
		   		$(otherTab).addClass("hide");
		   	});
		}

		/**********************************************************************************************
		*
		* arrivals screen - bus tab items
		* 
	   	**********************************************************************************************/

	   	// Script for the bus route drop down select menu
		const busRouteSelect = new mdc.select.MDCSelect(document.querySelector("#busRoute"));

		// Script for the bus direction drop down select menu
		const busDirectionSelect = new mdc.select.MDCSelect(document.querySelector("#busDirection"));

		// Script for the bus stop drop down select menu
		const busStopSelect = new mdc.select.MDCSelect(document.querySelector("#busStop"));

	   	// add action listener for a change to the first drop down menu on the arrivals screen - bus tab
	   	$("#busRoute").change(function(){
			console.log("Bus Route Changed");

			// grab the selected route that was clicked
			var busRouteSelect = document.getElementById("busRouteSelect");
			var clickedValue = busRouteSelect.options[busRouteSelect.selectedIndex].value;

			// change the direction value options depending on what route was chosen
			// the eight bus is the only one that has North/South options
			// the rest only have East/West options
			if (clickedValue === "eight") {
				$("#north").removeClass("hide");
				$("#south").removeClass("hide");
				$("#east").addClass("hide");
				$("#west").addClass("hide");
			}
			else {
				$("#east").removeClass("hide");
				$("#west").removeClass("hide");
				$("#north").addClass("hide");
				$("#south").addClass("hide");
			}

			// make sure to pre-select the first empty value of the direction select
			// every single time the route is changed in order to prevent incorrect 
			// direction being handled with the wrong route
			$("#busDirectionSelect").prop("selectedIndex",0);
		});

	   	// add action listener for a change to the second drop down menu on the arrivals screen - bus tab
		$("#busDirection").change(function(){
			console.log("change direction");
		});

		// add action listener for a change to the third drop down menu on the arrivals screen - bus tab
		$("#busStop").change(function(){
			console.log("change stop");
		});

		// To add the ink ripple effect to a button, attach a ripple instance to the button element.
		// this ripple effect is attached to the button on the arrivals screen in the bus tab
		mdc.ripple.MDCRipple.attachTo(document.querySelector('.mdc-button'));

		// action listener to the submit button on the arrivals screen - bus tab
		$("#busSubmitBtn").click(function(){
			alert("bus clicked button");
		});


		/**********************************************************************************************
		*
		* arrivals screen - train tab items
		* 
	   	**********************************************************************************************/

	   	// Script for the bus route drop down select menu - train tab
		const trainStopSelect = new mdc.select.MDCSelect(document.querySelector("#trainStop"));

		// action listener to the submit button on the arrivals screen - train tab
		$("#trainSubmitBtn").click(function(){
			alert("train clicked button");
		});

		/**********************************************************************************************
		*
		* near me screen
		* 
	   	**********************************************************************************************/

	   	// set the default location to UIC SCE
	   	var userLocation = {lat: 41.872051, lng: -87.647735};

	   	var flag = false;

	   	// additional action listener for the near me button in the tool bar
	   	$("#nearMeNav").click(function(){

	   		if ("geolocation" in navigator) 
			{	
				// get the geolocation of the user
				navigator.geolocation.getCurrentPosition(function(position) {

				  	userLocation.lat = position.coords.latitude;
				  	userLocation.lng = position.coords.longitude;

				  	flag = true;

				  	initMap();
				});
			} 
			else 
			{
			  alert("geolocation IS NOT available");
			}
	   	});

	   	// the variable that is the map
    	var map;

    	// add the map to the map screen inside the div with id 'map'
    	function initMap() 
    	{
	        var pin = userLocation;
	        map = new google.maps.Map(document.getElementById("map"), 
	        {
	          zoom: 19,
	          center: pin
        	});

        	if (flag)
        	{
        		var marker = new google.maps.Marker({
        			position: userLocation,
        			map: map,
        			title: "Your Location"
        		});
        	}
	    }

		/**********************************************************************************************
		*
		* AJAX calls / building data arrays
		* 
	   	**********************************************************************************************/

	    var sevenStopsWest = [];
	    var sixtyStopsWest = [];

	    function sevenWest(response)
	    {
	    	$.each(response["stops"], function(i, v){

	    		var id = parseInt(v.stpid);

	    		if (id === 6364 || id === 6365 || id === 206 || id === 207 || id === 208)
	    		{
	    			sevenStopsWest.push(v);
	    			sixtyStopsWest.push(v);
	    		}
	    		else if (id === 210 || id === 18340 || id === 18335)
	    		{
	    			sevenStopsWest.push(v);
	    		}
	    	});
	    }

	    function sixtyWest(response)
	    {
	    	$.each(response["stops"], function(i, v){

	    		var id = parseInt(v.stpid);

	    		if (id === 6366 || id === 6366 || id === 15401 || id === 15402 || id === 15292 || id === 15403 || id === 6370 || id === 6371)
	    		{
	    			sixtyStopsWest.push(v);
	    		}
	    	});
	    }

	    var sevenStopsEast = [];
	    var sixtyStopsEast = [];

	    function sevenEast(response)
	    {
	    	$.each(response["stops"], function(i, v){
	    		
	    		var id = parseInt(v.stpid);

	    		if (id === 14210 || id === 17995 || id === 6347 || id === 201 || id === 200)
	    		{
	    			sevenStopsEast.push(v);
	    			sixtyStopsEast.push(v);
	    		}
	    		else if (id === 198 || id === 18339 || id === 18336)
	    		{
	    			sevenStopsEast.push(v);
	    		}
	    	});
	    }

		// // AJAX stuff
		proxy = "https://polar-garden-75406.herokuapp.com/apiPassThru.php?apiEndpoint=";

		// array that has each URL for each bus stop and for the route and direction given
		busStopsURLs = [
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=7&dir=Eastbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=7&dir=Westbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=8&dir=Southbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=8&dir=Northbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=12&dir=Eastbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=12&dir=Westbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=60&dir=Eastbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=60&dir=Westbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=157&dir=Eastbound&format=json",
			"http://ctabustracker.com/bustime/api/v2/getstops&key=ARXsvPdwAMNqNgnbMuyVreNbq&rt=157&dir=Westbound&format=json"
		];

		$.ajax(
	    {
	    	// the url for requesting school type data from the api
	        url: proxy += busStopsURLs[0],
	        method: 'GET',
	     }).done(function(response) 
		    {
		    	response = JSON.parse(response);

		    	//console.log(response);

		    	sevenEast(response["bustime-response"]);

		    	
		        
		    }).fail(function(err) 
			   {
			   		throw err;
		       });

		



    </script>
    <!-- Google Maps API -->
    <script async defer
    	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD0zHggstjz-FDhr9M8nHdzOxEa_5QCvnY&callback=initMap">
    </script>
</body>
</html>